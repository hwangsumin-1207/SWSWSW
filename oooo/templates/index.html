<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D-Day 알리미</title>
    <script src="https://cdn.socket.io/4.0.1/socket.io.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; margin-top: 50px; }
        #dday { font-size: 40px; font-weight: bold; margin-bottom: 20px; }
        input, button { font-size: 16px; padding: 10px; margin: 5px; }
        form { margin-top: 30px; }
    </style>
</head>
<body>
    <h1>D-Day 알리미</h1>
    <div id="dday">
        <!-- D-Day가 실시간으로 업데이트됩니다 -->
        D-Day까지 남은 일: <span id="days-left">Calculating...</span>일
    </div>

    <!-- 날짜 설정 폼 -->
    <form id="set-dday-form">
        <label for="year">연도: </label>
        <input type="number" id="year" min="1900" max="2100" required>
        <label for="month">월: </label>
        <input type="number" id="month" min="1" max="12" required>
        <label for="day">일: </label>
        <input type="number" id="day" min="1" max="31" required>
        <button type="submit">D-Day 설정</button>
    </form>

    <script>
        var socket = io.connect('http://' + document.domain + ':' + location.port);

        // D-Day 정보가 변경될 때마다 UI 업데이트
        socket.on('dday_update', function(data) {
            var days = data.days;
            var seconds = data.seconds;
            var hours = Math.floor(seconds / 3600);
            var minutes = Math.floor((seconds % 3600) / 60);
            var seconds = seconds % 60;

            document.getElementById('days-left').innerText = days + '일 ' + hours + '시간 ' + minutes + '분 ' + seconds + '초';
        });

        // D-Day 설정 폼 제출 시 서버에 데이터 보내기
        document.getElementById('set-dday-form').addEventListener('submit', function(event) {
            event.preventDefault();

            var year = document.getElementById('year').value;
            var month = document.getElementById('month').value;
            var day = document.getElementById('day').value;

            // 서버에 새로운 D-Day 설정 요청
            fetch('/set_dday', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: 'year=' + year + '&month=' + month + '&day=' + day
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    alert('D-Day가 설정되었습니다: ' + data.new_dday);
                }
            });
        });
    </script>
</body>
</html>
